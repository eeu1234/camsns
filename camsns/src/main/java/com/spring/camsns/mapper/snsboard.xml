<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="snsboard">

   

   <select id ="boardList" resultType="com.spring.camsns.dto.SnsboardCategoryDTO" parameterType="String">
   SELECT A.* FROM (SELECT A.*, B.* FROM (SELECT B.UNIVERSITY_NAME AS universityName,B.UNIVERSITY_SEQ AS universitySeq ,A.USER_EMAIL_ID AS userEmailId, A.USER_REGDATE AS userRegDate, A.USER_LEVEL AS userLevel, A.UNIVERSITY_SEQ_FK AS universitySeqFk FROM USER A INNER JOIN UNIVERSITY B ON A.UNIVERSITY_SEQ_FK = B.UNIVERSITY_SEQ) A INNER JOIN (SELECT B.CATEGORY_NAME AS categoryName, B.CATEGORY_TYPE AS categoryType, A.SNSBOARD_SEQ AS snsboardSeq, A.SNSBOARD_SUBJECT AS snsboardSubject, A.SNSBOARD_CONTENT AS snsboardContent, A.SNSBOARD_REGDATE AS snsboardRegdate, A.SNSBOARD_BLIND AS snsboardBlind, A.SNSBOARD_STAT AS snsboardStat, A.USER_EMAIL_ID_FK AS userEmailIdFk , A.CATEGORY_SEQ_FK AS categorySeqFk FROM SNSBOARD A INNER JOIN CATEGORY B ON A.CATEGORY_SEQ_FK = B.CATEGORY_SEQ) B ON A.userEmailId = B.userEmailIdFk) A WHERE universitySeq = #{universitySeq}  ORDER BY snsboardSeq DESC LIMIT 0,5; 
    </select>


   <select id ="moreView" resultType="com.spring.camsns.dto.SnsboardCategoryDTO" parameterType="map">
	   SELECT A.* FROM (SELECT A.*, B.* FROM (SELECT B.UNIVERSITY_NAME AS universityName,B.UNIVERSITY_SEQ AS universitySeq ,A.USER_EMAIL_ID AS userEmailId, A.USER_REGDATE AS userRegDate, A.USER_LEVEL AS userLevel, A.UNIVERSITY_SEQ_FK AS universitySeqFk FROM USER A INNER JOIN UNIVERSITY B ON A.UNIVERSITY_SEQ_FK = B.UNIVERSITY_SEQ) A INNER JOIN (SELECT B.CATEGORY_NAME AS categoryName, B.CATEGORY_TYPE AS categoryType, A.SNSBOARD_SEQ AS snsboardSeq, A.SNSBOARD_SUBJECT AS snsboardSubject, A.SNSBOARD_CONTENT AS snsboardContent, A.SNSBOARD_REGDATE AS snsboardRegdate, A.SNSBOARD_BLIND AS snsboardBlind, A.SNSBOARD_STAT AS snsboardStat, A.USER_EMAIL_ID_FK AS userEmailIdFk , A.CATEGORY_SEQ_FK AS categorySeqFk FROM SNSBOARD A INNER JOIN CATEGORY B ON A.CATEGORY_SEQ_FK = B.CATEGORY_SEQ) B ON A.userEmailId = B.userEmailIdFk) A WHERE universitySeq = #{universitySeq}  ORDER BY snsboardSeq DESC LIMIT ${index},5; 
    </select>
   

   <select id ="boardOne" resultType="com.spring.camsns.dto.SnsboardCategoryDTO" parameterType="String">
    SELECT A.SNSBOARD_SEQ AS snsboardSeq, A.SNSBOARD_SUBJECT AS snsboardSubject, A.SNSBOARD_CONTENT AS snsboardContent, A.SNSBOARD_REGDATE AS snsboardRegdate, A.SNSBOARD_BLIND AS snsboardBlind, A.SNSBOARD_STAT AS snsboardStat, A.USER_EMAIL_ID_FK AS userEmailIdFk , B.CATEGORY_NAME AS categoryName,B.CATEGORY_TYPE AS categoryType FROM SNSBOARD A INNER JOIN CATEGORY B WHERE A.CATEGORY_SEQ_FK = B.CATEGORY_SEQ  AND  A.SNSBOARD_SEQ= #{boardSeq}
    </select>
   
   
   

   
   <!-- 글 추가하기 -->
	<insert id="writeBoard" parameterType="com.spring.camsns.dto.SnsboardDTO" >
		
		INSERT INTO SNSBOARD (SNSBOARD_SUBJECT, SNSBOARD_CONTENT, USER_EMAIL_ID_FK, CATEGORY_SEQ_FK) VALUES (#{snsboardSubject}, #{snsboardContent}, #{userEmailIdFk}, #{categorySeqFk});
	</insert>
	
	
	<!--글 쓴거 글번호가져오기 -->
 	<select id ="writeSeq" parameterType="String" resultType="com.spring.camsns.dto.SnsboardDTO">
   	 SELECT SNSBOARD_SEQ AS snsboardSeq,USER_EMAIL_ID_FK AS userEmailIdFk FROM SNSBOARD WHERE USER_EMAIL_ID_FK = #{userEmailIdFk} ORDER by SNSBOARD_SEQ DESC LIMIT 0,1; 
    </select>
    
    
   <!-- 파일 입력 -->
	<insert id="writeFile" parameterType="com.spring.camsns.dto.SnsboardDTO" >
		INSERT INTO SNSBOARDFILE (SNSBOARDFILE_FILENAME, SNSBOARD_SEQ_FK) VALUES (#{snsboardfileName}, #{snsboardSeqFk});
	</insert>
	
	
   
</mapper>








